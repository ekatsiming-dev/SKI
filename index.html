<!DOCTYPE html>
<html lang="zh-Hant" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>野澤滑雪互動準備儀表板 | Nozawa Onsen Trip Planner</title>
    <!-- Chosen Palette: Nozawa Winter -->
    <!-- Application Structure Plan: Inspired by the provided reference, the structure is a complete redesign into a modern, card-based, single-page application. The key change is the introduction of a more dynamic grid layout and dedicated sections for a clearer narrative flow, from high-level planning (Roadmap, Itinerary) to actionable details (Checklist, Budget). A new 'Itinerary' section was added to provide a chronological story of the trip. The most significant interactive enhancement is the dynamic budget calculator with a slider, allowing real-time 'what-if' analysis of personal spending. This structure was chosen to transform the tool from a static checklist into an engaging, visually-driven planning experience that encourages exploration and personalization. -->
    <!-- Visualization & Content Choices: 1. Countdown/Stats (Inform): Redesigned as prominent hero stats with icons. 2. Itinerary (Organize): A new visual timeline component using HTML/CSS to clearly show the day-by-day plan. 3. Interactive Checklist (Interact): UI refreshed with improved styling for buttons and items to match the new theme. 4. Dynamic Budget Calculator (Interact/Analyze): The static budget table is now interactive. A range slider allows users to adjust personal spending, which dynamically updates the total cost and the Chart.js doughnut chart via Vanilla JS. This provides immediate visual feedback on financial planning. Justification: These choices elevate the user experience by making information more digestible (icons, cards), providing a clearer trip narrative (itinerary), and adding powerful, personalized interactivity (budget calculator). -->
    <!-- CONFIRMATION: NO SVG graphics used. NO Mermaid JS used. -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Noto+Sans+TC:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg-color: #f8f9fa;
            --card-bg: #ffffff;
            --text-primary: #212529;
            --text-secondary: #495057;
            --accent-primary: #1a365d; /* Indigo Night */
            --accent-secondary: #a97c50; /* Warm Wood */
            --border-color: #dee2e6;
        }
        body {
            font-family: 'Inter', 'Noto Sans TC', sans-serif;
            background-color: var(--bg-color);
            color: var(--text-primary);
        }
        .chart-container {
            position: relative;
            width: 100%;
            max-width: 400px;
            margin-left: auto;
            margin-right: auto;
            height: 350px;
            max-height: 400px;
        }
        .nav-link {
            transition: all 0.2s ease-in-out;
            color: var(--text-secondary);
        }
        .nav-link:hover, .nav-link.active {
            color: var(--accent-primary);
            transform: translateY(-2px);
        }
        .btn-filter {
            transition: all 0.2s ease-in-out;
        }
        .btn-filter.active {
            background-color: var(--accent-primary);
            color: white;
            border-color: var(--accent-primary);
        }
        .glass-nav {
            background-color: rgba(255, 255, 255, 0.8);
            backdrop-filter: blur(10px);
        }
        .iti-item::before {
            content: '';
            position: absolute;
            left: -20.5px;
            top: 50%;
            transform: translateY(-50%);
            width: 15px;
            height: 15px;
            border-radius: 9999px;
            background-color: var(--accent-secondary);
            border: 3px solid var(--card-bg);
        }
        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 20px;
            height: 20px;
            background: var(--accent-primary);
            cursor: pointer;
            border-radius: 50%;
        }
        input[type="range"]::-moz-range-thumb {
            width: 20px;
            height: 20px;
            background: var(--accent-primary);
            cursor: pointer;
            border-radius: 50%;
        }
        .hero-text-shadow {
            text-shadow: 0 2px 4px rgba(0,0,0,0.5);
        }
    </style>
</head>
<body class="antialiased">

    <div class="container mx-auto px-4 py-8 md:py-12">

        <header class="relative rounded-2xl overflow-hidden shadow-2xl mb-12 h-80 md:h-96 flex items-center justify-center text-center">
            <img src="https://andyventure.com/wp-content/uploads/2024/07/japan_nozawa_onsen_village_20230228_DSC01732.webp" alt="野澤溫泉村莊的冬季夜景" class="absolute inset-0 w-full h-full object-cover">
            <div class="absolute inset-0 bg-black/50"></div>
            <div class="relative z-10 px-4">
                <h1 class="text-4xl sm:text-5xl md:text-6xl font-bold text-white hero-text-shadow">野澤溫泉滑雪之旅</h1>
                <p class="text-xl sm:text-2xl text-white/90 mt-4 hero-text-shadow">2026/1/14 - 2026/1/18</p>
            </div>
        </header>

        <section id="overview" class="mb-20 text-center max-w-sm mx-auto">
             <div class="bg-white rounded-2xl shadow-lg p-6 border border-gray-200">
                <h3 class="text-lg font-semibold text-slate-500 flex items-center justify-center gap-2">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>
                    旅程倒數
                </h3>
                <p id="countdown" class="text-5xl font-bold text-[var(--accent-primary)] mt-2">計算中...</p>
            </div>
        </section>

        <nav class="sticky top-4 glass-nav z-20 py-3 mb-20 rounded-full shadow-md border border-gray-200">
            <div class="flex flex-wrap justify-center items-center gap-x-4 sm:gap-x-6 md:gap-x-10 text-sm sm:text-base md:text-lg font-semibold">
                <a href="#itinerary" class="nav-link">行程總覽</a>
                <a href="#village-guide" class="nav-link">村莊探索</a>
                <a href="#ski-guide" class="nav-link">滑雪指南</a>
                <a href="#lodging" class="nav-link">住宿美食</a>
                <a href="#roadmap" class="nav-link personal-nav-link hidden">準備計畫</a>
                <a href="#checklist" class="nav-link personal-nav-link hidden">互動清單</a>
                <a href="#budget" class="nav-link personal-nav-link hidden">預算分析</a>
            </div>
        </nav>
        
        <main class="space-y-20">

            <section id="itinerary">
                <h2 class="text-3xl font-bold text-center mb-12">行程總覽</h2>
                <div class="max-w-3xl mx-auto relative border-l-2 border-dashed border-yellow-400 pl-10">
                    <div class="iti-item relative mb-10 bg-white p-6 rounded-lg shadow-md border border-gray-200">
                        <p class="absolute -left-10 top-1/2 -translate-y-1/2 bg-[var(--accent-secondary)] text-white text-xs font-bold px-2 py-1 rounded-full">Day 1</p>
                        <h3 class="font-bold text-lg text-[var(--accent-secondary)]">移動與抵達</h3>
                        <p class="text-slate-500 text-sm">2026 / 01 / 14 (三)</p>
                        <ul class="list-disc list-inside mt-2 text-slate-600 space-y-1">
                            <li>搭乘 MM620 (02:20) 前往東京成田機場 (NRT)</li>
                            <li>轉乘新幹線 (13:30) 前往飯山站</li>
                            <li>抵達野澤溫泉，至 <span class="font-bold">Yamasanso</span> Check-in</li>
                            <li>晚餐推薦：<span class="font-bold">お好み焼き 一ちゃん</span> (住宿附近)</li>
                            <li>在溫泉街悠閒漫步，熟悉環境</li>
                        </ul>
                    </div>
                    <div class="iti-item relative mb-10 bg-white p-6 rounded-lg shadow-md border border-gray-200">
                        <p class="absolute -left-10 top-1/2 -translate-y-1/2 bg-[var(--accent-secondary)] text-white text-xs font-bold px-2 py-1 rounded-full">Day 2</p>
                        <h3 class="font-bold text-lg text-[var(--accent-secondary)]">全日滑雪課程 & 道祖神祭</h3>
                        <p class="text-slate-500 text-sm">2026 / 01 / 15 (四)</p>
                        <ul class="list-disc list-inside mt-2 text-slate-600 space-y-1">
                            <li>全日6小時滑雪技巧學習</li>
                            <li>晚餐推薦：<span class="font-bold">焼肉 やま冨士</span> (住宿附近燒肉)</li>
                            <li>晚上參加日本三大火祭之一的「道祖神祭」，體驗獨特的火光與祈福儀式。</li>
                        </ul>
                        <div class="mt-4 bg-indigo-50 border border-indigo-200 p-3 rounded-md">
                            <h4 class="font-semibold text-sm text-indigo-800">本日租賃裝備提醒</h4>
                            <p class="text-xs text-indigo-600">雪衣、雪褲、雪板、雪鞋、安全帽、雪鏡、手套、防摔褲、護膝</p>
                        </div>
                    </div>
                     <div class="iti-item relative mb-10 bg-white p-6 rounded-lg shadow-md border border-gray-200">
                        <p class="absolute -left-10 top-1/2 -translate-y-1/2 bg-[var(--accent-secondary)] text-white text-xs font-bold px-2 py-1 rounded-full">Day 3</p>
                        <h3 class="font-bold text-lg text-[var(--accent-secondary)]">全日滑雪課程 & 溫泉體驗</h3>
                        <p class="text-slate-500 text-sm">2026 / 01 / 16 (五)</p>
                         <ul class="list-disc list-inside mt-2 text-slate-600 space-y-1">
                             <li>全日6小時滑雪技巧進階</li>
                             <li>晚餐推薦：<span class="font-bold">ちゃんこ玉屋</span> (相撲鍋暖身)</li>
                             <li>體驗「外湯巡禮」，感受村民守護的溫泉文化，開始<span class="font-bold">搜集印章</span>換獎品！</li>
                         </ul>
                    </div>
                    <div class="iti-item relative mb-10 bg-white p-6 rounded-lg shadow-md border border-gray-200">
                        <p class="absolute -left-10 top-1/2 -translate-y-1/2 bg-[var(--accent-secondary)] text-white text-xs font-bold px-2 py-1 rounded-full">Day 4</p>
                        <h3 class="font-bold text-lg text-[var(--accent-secondary)]">自主練習 & 自由探索</h3>
                         <p class="text-slate-500 text-sm">2026 / 01 / 17 (六)</p>
                        <ul class="list-disc list-inside mt-2 text-slate-600 space-y-1">
                            <li>驗收學習成果，在初級雪道自主練習</li>
                            <li>午餐推薦：<span class="font-bold">大門 (Daimon)</span> (溫泉街豬排飯)</li>
                            <li>探索野澤村：參觀<span class="font-bold">湯澤神社</span>、在「麻釜」<span class="font-bold">做溫泉蛋</span>。</li>
                            <li>品嚐溫泉街小吃：冰淇淋、野澤菜包。</li>
                        </ul>
                    </div>
                     <div class="iti-item relative bg-white p-6 rounded-lg shadow-md border border-gray-200">
                        <p class="absolute -left-10 top-1/2 -translate-y-1/2 bg-[var(--accent-secondary)] text-white text-xs font-bold px-2 py-1 rounded-full">Day 5</p>
                        <h3 class="font-bold text-lg text-[var(--accent-secondary)]">返程</h3>
                         <p class="text-slate-500 text-sm">2026 / 01 / 18 (日)</p>
                         <ul class="list-disc list-inside mt-2 text-slate-600 space-y-1">
                             <li>上午最後巡禮，購買伴手禮</li>
                             <li>整理行囊，準備前往飯山站</li>
                             <li>搭乘 MM625 (16:35) 返回台灣桃園機場 (TPE)</li>
                         </ul>
                    </div>
                </div>
            </section>
            
            <section id="village-guide">
                <h2 class="text-3xl font-bold text-center mb-12">溫泉村莊探索</h2>
                <div class="max-w-5xl mx-auto space-y-12">
                     <div class="bg-white p-6 rounded-lg shadow-md border border-gray-200">
                        <h3 class="font-bold text-xl text-[var(--accent-primary)] mb-4 flex items-center gap-2">
                           <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M14 10h4.764a2 2 0 011.789 2.894l-3.5 7A2 2 0 0115.263 21h-4.017c-.163 0-.326-.02-.485-.06L7 20m6-10V5a2 2 0 00-2-2h-.085a2 2 0 00-1.736.93L5 10m6 0v10"></path></svg>
                           泡湯禮儀
                        </h3>
                        <div class="bg-gray-100 rounded-lg overflow-hidden border">
                            <img src="https://andyventure.com/wp-content/uploads/japan/nozawa_onsen_village/onsen_bath_guide.jpg" alt="泡湯禮儀圖解" class="w-full h-auto object-contain">
                        </div>
                    </div>
                    <div class="bg-white p-6 rounded-lg shadow-md border border-gray-200">
                        <h3 class="font-bold text-xl text-[var(--accent-primary)] mb-4 flex items-center gap-2">
                           <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path d="M12 14l9-5-9-5-9 5 9 5z"></path><path d="M12 14l6.16-3.422a12.083 12.083 0 01.665 6.479A11.952 11.952 0 0012 20.055a11.952 11.952 0 00-6.824-2.998 12.078 12.078 0 01.665-6.479L12 14z"></path><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 14l9-5-9-5-9 5 9 5zm0 0l6.16-3.422a12.083 12.083 0 01.665 6.479A11.952 11.952 0 0012 20.055a11.952 11.952 0 00-6.824-2.998 12.078 12.078 0 01.665-6.479L12 14zm-4 6v-7.5l4-2.222 4 2.222V20"></path></svg>
                           外湯巡禮 (Sotoyu)
                        </h3>
                        <p class="text-slate-600 mb-6">「外湯」是村民共有的13座免費大眾湯屋。滑雪後泡湯能極大地放鬆肌肉。雖為免費，但建議在捐款箱投入少許金額支持維護。記得自備毛巾與盥洗用品。</p>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4 text-sm">
                            <div class="bg-gray-50 p-4 rounded-lg border">
                                <p class="font-bold text-slate-700">夏季 (4月～11月)</p>
                                <p>5:00 AM – 11:00 PM</p>
                            </div>
                            <div class="bg-gray-50 p-4 rounded-lg border">
                                <p class="font-bold text-slate-700">冬季 (12月～3月)</p>
                                <p>6:00 AM – 11:00 PM</p>
                            </div>
                        </div>
                         <div class="mt-6 grid grid-cols-1 sm:grid-cols-2 gap-6">
                            <div class="bg-white rounded-lg overflow-hidden border">
                               <img src="https://andyventure.com/wp-content/uploads/japan/nozawa_onsen_village/sotoyu_map.jpg" alt="13座外湯地圖" class="w-full h-auto object-contain">
                           </div>
                           <div class="bg-white rounded-lg overflow-hidden border">
                               <img src="https://andyventure.com/wp-content/uploads/japan/nozawa_onsen_village/nozawa_onsen_village_map_small.jpg" alt="野澤溫泉村景點地圖" class="w-full h-auto object-contain">
                           </div>
                        </div>
                        <div class="mt-8">
                             <h4 class="font-semibold text-lg text-slate-700 border-b-2 border-yellow-400 pb-2 mb-6">13座外湯特色一覽</h4>
                             <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4 text-xs">
                                 <div class="bg-white p-3 rounded-lg shadow-sm border"><p class="font-bold">大湯 (Oyu)</p><p class="text-slate-500">指標性湯屋，純硫磺泉。</p></div>
                                 <div class="bg-white p-3 rounded-lg shadow-sm border"><p class="font-bold">河原湯</p><p class="text-slate-500">水溫較高，含石膏-食鹽・硫磺泉。</p></div>
                                 <div class="bg-white p-3 rounded-lg shadow-sm border"><p class="font-bold">秋葉の湯</p><p class="text-slate-500">源自麻釜，含芒硝、石膏的硫磺泉。</p></div>
                                 <div class="bg-white p-3 rounded-lg shadow-sm border"><p class="font-bold">麻釜の湯</p><p class="text-slate-500">對痔瘡、糖尿病有療效。</p></div>
                                 <div class="bg-white p-3 rounded-lg shadow-sm border"><p class="font-bold">上寺湯</p><p class="text-slate-500">對切傷、燒傷癒合效果好。</p></div>
                                 <div class="bg-white p-3 rounded-lg shadow-sm border"><p class="font-bold">熊の手洗湯</p><p class="text-slate-500">對燒傷和切傷有療效。</p></div>
                                 <div class="bg-white p-3 rounded-lg shadow-sm border"><p class="font-bold">松葉の湯</p><p class="text-slate-500">與麻釜の湯療效相同。</p></div>
                                 <div class="bg-white p-3 rounded-lg shadow-sm border"><p class="font-bold">中尾の湯</p><p class="text-slate-500">最大木造澡堂，對皮膚病有效。</p></div>
                                 <div class="bg-white p-3 rounded-lg shadow-sm border"><p class="font-bold">新田の湯</p><p class="text-slate-500">對痔瘡、糖尿病、風濕病有效。</p></div>
                                 <div class="bg-white p-3 rounded-lg shadow-sm border"><p class="font-bold">真湯</p><p class="text-slate-500">純硫磺泉，有豐富溫泉花。</p></div>
                                 <div class="bg-white p-3 rounded-lg shadow-sm border"><p class="font-bold">滝の湯</p><p class="text-slate-500">源泉水溫高達78度。</p></div>
                                 <div class="bg-white p-3 rounded-lg shadow-sm border"><p class="font-bold">横落の湯</p><p class="text-slate-500">對皮膚病特別有效。</p></div>
                                 <div class="bg-white p-3 rounded-lg shadow-sm border"><p class="font-bold">十王堂の湯</p><p class="text-slate-500">混合麻釜與大湯的泉水。</p></div>
                             </div>
                        </div>
                    </div>
                </div>
            </section>

            <section id="ski-guide">
                <h2 class="text-3xl font-bold text-center mb-12">滑雪完全指南</h2>
                <div class="max-w-5xl mx-auto space-y-12">
                     <div class="bg-white p-6 rounded-lg shadow-md border border-gray-200">
                        <h3 class="font-bold text-xl text-[var(--accent-primary)] mb-4 flex items-center gap-2">
                            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 20l-5.447-2.724A1 1 0 013 16.382V5.618a1 1 0 011.447-.894L20 12 4.447 19.106A1 1 0 013 18.212V17"></path></svg>
                           飯店至雪場路線圖
                        </h3>
                        <div class="bg-gray-100 rounded-lg overflow-hidden border">
                            <iframe src="https://www.google.com/maps/embed?pb=!1m28!1m12!1m3!1d6379.799723049007!2d138.44199302196397!3d36.91835338169145!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!4m13!3e2!4m5!1s0x5ff61b5ae178668d%3A0x85073d9e6ac629b7!2zWWFtYXNhbnNvLCA2NTE5IFRveW9zYXRvLCBOb3phd2FvbnNlbiwgU2hpbW90YWthaSBHdW4sIE5hZ2FubyAzODktMjUwMi5qYXBhbg!3m2!1d36.9162856!2d138.4422852!4m5!1s0x5ff605299256ce13%3A0x93879d18bb530dba!2z5rC45r6k5rqr5rOJ5ruR5ry-6Zuq5aC0LCA3NjUzIFRveW9zYXRvLCBOb3phd2FvbnNlbiwgU2hpbW90YWthaSBHdW4sIE5hZ2FubyAzODktMjUwMi4gSmFwYW4!3m2!1d36.9206775!2d138.4523232!5e0!3m2!1sen!2stw!4v1759328221184!5m2!1sen!2stw" class="w-full h-80 md:h-96" style="border:0;" allowfullscreen="" loading="lazy" referrerpolicy="no-referrer-when-downgrade"></iframe>
                        </div>
                    </div>
                    
                    <div class="bg-white p-6 rounded-lg shadow-md border border-gray-200">
                        <h3 class="font-bold text-xl text-[var(--accent-primary)] mb-4 flex items-center gap-2">
                           <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"></path></svg>
                           滑雪服裝準備
                        </h3>
                        <div class="mb-6 grid grid-cols-1 md:grid-cols-3 gap-6 text-center">
                            <div class="border border-gray-200 p-4 rounded-lg">
                                <h4 class="font-bold text-slate-700">① 底層：吸濕排汗</h4>
                                <p class="text-sm text-slate-500 mt-2">功能：保持身體乾爽。<br>材質：聚酯纖維、羊毛等機能性布料。<br><strong class="text-red-600">絕對避免棉質！</strong></p>
                            </div>
                            <div class="border border-gray-200 p-4 rounded-lg">
                                <h4 class="font-bold text-slate-700">② 中層：保暖</h4>
                                <p class="text-sm text-slate-500 mt-2">功能：鎖住熱空氣，隔絕冷空氣。<br>材質：刷毛 (Fleece)、輕羽絨、化纖外套。</p>
                            </div>
                            <div class="border border-gray-200 p-4 rounded-lg">
                                <h4 class="font-bold text-slate-700">③ 外層：防水防風</h4>
                                <p class="text-sm text-slate-500 mt-2">功能：抵禦風、雪、雨。<br>材質：專業雪衣雪褲 (Gore-Tex 等)。</p>
                            </div>
                        </div>
                         <div class="bg-gray-50 p-4 rounded-lg border">
                            <h4 class="font-semibold text-slate-700 mb-3 text-center">裝備檢查清單</h4>
                            <div class="grid grid-cols-2 md:grid-cols-4 gap-4 text-sm">
                                <div><strong class="text-slate-600">頭部：</strong><p>毛帽、安全帽、雪鏡、面罩/脖圍</p></div>
                                <div><strong class="text-slate-600">上半身：</strong><p>底層衣、中層衣、雪衣</p></div>
                                <div><strong class="text-slate-600">下半身：</strong><p>底層褲、防摔褲(建議)、雪褲</p></div>
                                <div><strong class="text-slate-600">手腳：</strong><p>防水手套、羊毛雪襪</p></div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="bg-white p-6 rounded-lg shadow-md border border-gray-200">
                         <h3 class="font-bold text-xl text-[var(--accent-primary)] mb-4 flex items-center gap-2">
                            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"></path><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 11a3 3 0 11-6 0 3 3 0 016 0z"></path></svg>
                            雪道推薦
                        </h3>
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                            <div class="border border-gray-200 p-4 rounded-lg">
                                <h4 class="font-bold text-green-600">新手推薦</h4>
                                <p class="text-sm text-slate-500 mt-1">寬廣平緩，適合初學</p>
                                <p class="mt-2 font-semibold">上ノ平ゲレンデ (Uenotaira)</p>
                            </div>
                            <div class="border border-gray-200 p-4 rounded-lg">
                                <h4 class="font-bold text-blue-600">中手挑戰</h4>
                                <p class="text-sm text-slate-500 mt-1">多樣地形，練習技巧</p>
                                <p class="mt-2 font-semibold">やまびこ A-Eコース (Yamabiko)</p>
                            </div>
                             <div class="border border-gray-200 p-4 rounded-lg">
                                <h4 class="font-bold text-red-600">高手專區</h4>
                                <p class="text-sm text-slate-500 mt-1">最大斜度39度，挑戰粉雪</p>
                                <p class="mt-2 font-semibold">シュナイダーコース (Schneider)</p>
                            </div>
                        </div>
                    </div>
                    
                    <div class="bg-white p-6 rounded-lg shadow-md border border-gray-200">
                        <h3 class="font-bold text-xl text-[var(--accent-primary)] mb-4 flex items-center gap-2">
                           <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>
                           滑雪安全須知
                        </h3>
                         <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                            <div class="bg-white p-4 rounded-lg">
                                <p class="font-bold text-lg mb-2">① 正確跌倒，保護自己</p>
                                <p class="text-slate-600">感覺快要失控時，主動向後方或側後方坐倒。**核心技巧是「用屁股著地」**，絕對不要用手腕去撐地，非常容易造成手腕骨折。</p>
                            </div>
                            <div class="bg-white p-4 rounded-lg">
                                <p class="font-bold text-lg mb-2">② 選擇適合自己的雪道</p>
                                <p class="text-slate-600">雪場會用顏色標示雪道難度（綠線：初級）。請務必在教練指導下，從綠線開始，**不要輕易挑戰超出自己能力的雪道**。</p>
                            </div>
                            <div class="bg-white p-4 rounded-lg">
                                <p class="font-bold text-lg mb-2">③ 隨時注意周遭環境</p>
                                <p class="text-slate-600">在雪道上休息或停留時，請務必停在**雪道的兩側**，避免停在雪道中間或轉彎處的死角，以免被後方滑行者撞上。</p>
                            </div>
                             <div class="bg-white p-4 rounded-lg">
                                <p class="font-bold text-lg mb-2">④ 安全裝備不可少</p>
                                <p class="text-slate-600">**安全帽是必備品**，能有效保護頭部。雪鏡和護具（如防摔褲、護膝）也能大幅增加安全性。</p>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <section id="lodging">
                <h2 class="text-3xl font-bold text-center mb-12">住宿 & 美食推薦</h2>
                <div class="max-w-5xl mx-auto">
                    <div class="bg-white p-6 rounded-lg shadow-md border border-gray-200 mb-12">
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6 items-center">
                            <div>
                                <h3 class="font-bold text-xl text-[var(--accent-primary)] mb-3 flex items-center gap-2">
                                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6"></path></svg>
                                    下榻飯店
                                </h3>
                                <p class="text-lg font-semibold">Yamasanso</p>
                            </div>
                            <div class="rounded-lg overflow-hidden border">
                                <iframe src="https://www.google.com/maps/embed?pb=!1m18!1m12!1m3!1d3189.915462284551!2d138.4422852!3d36.916285599999995!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0x5ff61b5ae178668d%3A0x85073d9e6ac629b7!2sYamasanso!5e0!3m2!1szh-TW!2stw!4v1759327161987!5m2!1szh-TW!2stw" class="w-full h-48" style="border:0;" allowfullscreen="" loading="lazy" referrerpolicy="no-referrer-when-downgrade"></iframe>
                            </div>
                        </div>
                    </div>

                    <div>
                        <h3 class="font-bold text-xl text-[var(--accent-primary)] mb-6 flex items-center gap-2">
                            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6.253v11.494m-9-5.747h18"></path><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6.253V5.5A2.25 2.25 0 0114.25 3h.5A2.25 2.25 0 0117 5.25V6.253"></path><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8.25 6.253V5.5A2.25 2.25 0 0110.5 3h.5A2.25 2.25 0 0113 5.25V6.253"></path><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5.25 17.747V19.5a.75.75 0 00.75.75h12a.75.75 0 00.75-.75v-1.753"></path></svg>
                            餐廳口袋名單
                        </h3>
                        
                        <div class="mb-8">
                            <h4 class="font-semibold text-lg text-slate-700 border-b-2 border-yellow-400 pb-2 mb-6">住宿附近</h4>
                            <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6">
                                <div class="bg-white p-5 rounded-lg shadow border transition-transform hover:scale-105 flex flex-col">
                                    <p class="font-bold">焼肉 やま冨士</p>
                                    <p class="text-sm text-slate-500 mt-1 mb-3 flex-grow">肉舖老闆開的燒肉店，便宜好吃但煙霧繚繞。<br><span class="text-indigo-600">電話: +81 269-85-2121</span><br><span class="text-red-500 font-semibold">(建議10人務必預約)</span></p>
                                    <a href="https://maps.app.goo.gl/Xema4Wy5LFK4bmQe8" target="_blank" class="text-sm font-semibold text-[var(--accent-primary)] hover:underline mt-auto">查看地圖 →</a>
                                </div>
                                <div class="bg-white p-5 rounded-lg shadow border transition-transform hover:scale-105 flex flex-col">
                                    <p class="font-bold">お好み焼き 一ちゃん</p>
                                    <p class="text-sm text-slate-500 mt-1 mb-3 flex-grow">住宿附近的大阪燒，有搭配部分小點心。<br><span class="text-indigo-600">電話: +81 269-85-3230</span><br><span class="text-red-500 font-semibold">(建議10人預約)</span></p>
                                    <a href="https://maps.app.goo.gl/dHJZGWeLGyB854178" target="_blank" class="text-sm font-semibold text-[var(--accent-primary)] hover:underline mt-auto">查看地圖 →</a>
                                </div>
                            </div>
                        </div>

                        <div>
                             <h4 class="font-semibold text-lg text-slate-700 border-b-2 border-yellow-400 pb-2 mb-6">溫泉街中心</h4>
                             <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6">
                                <div class="bg-white p-5 rounded-lg shadow border transition-transform hover:scale-105 flex flex-col">
                                    <p class="font-bold">大門 (Daimon)</p>
                                    <p class="text-sm text-slate-500 mt-1 mb-3 flex-grow">份量不錯的豬排飯、餃子。<br><span class="text-indigo-600">電話: +81 269-85-2570</span><br><span class="text-red-500 font-semibold">(不接受預約，10人需有排隊或分開坐的準備)</span></p>
                                    <a href="https://maps.app.goo.gl/9auQUjGnYBL4dRXXA" target="_blank" class="text-sm font-semibold text-[var(--accent-primary)] hover:underline mt-auto">查看地圖 →</a>
                                </div>
                                <div class="bg-white p-5 rounded-lg shadow border transition-transform hover:scale-105 flex flex-col">
                                    <p class="font-bold">ちゃんこ玉屋</p>
                                    <p class="text-sm text-slate-500 mt-1 mb-3 flex-grow">不起眼的相撲鍋與壽喜燒火鍋店。<br><span class="text-indigo-600">電話: +81 269-85-2435</span><br><span class="text-red-500 font-semibold">(建議10人務必預約)</span></p>
                                    <a href="https://maps.app.goo.gl/MaDPYRLNsiBhJvw9A" target="_blank" class="text-sm font-semibold text-[var(--accent-primary)] hover:underline mt-auto">查看地圖 →</a>
                                </div>
                                 <div class="bg-white p-5 rounded-lg shadow border transition-transform hover:scale-105 flex flex-col">
                                    <p class="font-bold">ばあどこ (Banri)</p>
                                    <p class="text-sm text-slate-500 mt-1 mb-3 flex-grow">受外國人歡迎，店員會講中文，似乎有素火鍋。<br><span class="text-indigo-600">電話: +81 269-85-2333</span><br><span class="text-red-500 font-semibold">(建議10人預約)</span></p>
                                    <a href="https://maps.app.goo.gl/z8jz93uj8dTezBpQ8" target="_blank" class="text-sm font-semibold text-[var(--accent-primary)] hover:underline mt-auto">查看地圖 →</a>
                                </div>
                                 <div class="bg-white p-5 rounded-lg shadow border transition-transform hover:scale-105 flex flex-col">
                                    <p class="font-bold">大まるそば店</p>
                                    <p class="text-sm text-slate-500 mt-1 mb-3 flex-grow">蕎麥麵店，冬季似乎有熱湯選項。<br><span class="text-indigo-600">電話: +81 269-85-2038</span><br><span class="text-red-500 font-semibold">(建議10人預約詢問)</span></p>
                                    <a href="https://maps.app.goo.gl/ZeLmRx18DeLYtofn6" target="_blank" class="text-sm font-semibold text-[var(--accent-primary)] hover:underline mt-auto">查看地圖 →</a>
                                </div>
                                <div class="bg-white p-5 rounded-lg shadow border transition-transform hover:scale-105 flex flex-col">
                                    <p class="font-bold">三吉 (San-kichi)</p>
                                    <p class="text-sm text-slate-500 mt-1 mb-3 flex-grow">關東煮，特色是有賣馬肉刺身。<br><span class="text-indigo-600">電話: +81 269-85-3933</span><br><span class="text-red-500 font-semibold">(建議10人預約)</span></p>
                                    <a href="https://maps.app.goo.gl/ZNtxotnGAbYGGa4o9" target="_blank" class="text-sm font-semibold text-[var(--accent-primary)] hover:underline mt-auto">查看地圖 →</a>
                                </div>
                                <div class="bg-white p-5 rounded-lg shadow border transition-transform hover:scale-105 flex flex-col">
                                    <p class="font-bold">そば処 大茂ん</p>
                                    <p class="text-sm text-slate-500 mt-1 mb-3 flex-grow">可預約牛肉壽喜燒的蕎麥麵店。<br><span class="text-indigo-600">電話: +81 269-85-2032</span><br><span class="text-red-500 font-semibold">(可預約，10人建議務必預約)</span></p>
                                    <a href="https://maps.app.goo.gl/i7GPzm396qtZyn62A" target="_blank" class="text-sm font-semibold text-[var(--accent-primary)] hover:underline mt-auto">查看地圖 →</a>
                                </div>
                                 <div class="bg-white p-5 rounded-lg shadow border transition-transform hover:scale-105 flex flex-col">
                                    <p class="font-bold">Playce Nozawa</p>
                                    <p class="text-sm text-slate-500 mt-1 mb-3 flex-grow">同時賣披薩、拉麵，晚上是居酒屋。<br><span class="text-indigo-600">電話: +81 269-67-0407</span><br><span class="text-red-500 font-semibold">(建議10人預約詢問)</span></p>
                                    <a href="https://maps.app.goo.gl/Yp6cHT3zhVovRM7A9" target="_blank" class="text-sm font-semibold text-[var(--accent-primary)] hover:underline mt-auto">查看地圖 →</a>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </section>
            
            <div id="personal-sections" class="hidden space-y-20">
                <section id="roadmap">
                    <h2 class="text-3xl font-bold text-center mb-12">準備時程計畫</h2>
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-8">
                        <div class="bg-white p-6 rounded-lg shadow-md border border-gray-200">
                            <h3 class="text-xl font-bold text-[var(--accent-primary)] mb-3">第一階段：核心準備</h3>
                            <p class="font-semibold text-slate-500 text-sm mb-4">現在 ~ 2025/10月底</p>
                            <ul class="space-y-2 text-slate-600">
                                <li>🔴 <span class="font-medium">換發護照：</span>最優先！</li>
                                <li>🔴 <span class="font-medium">預訂機票 & 住宿</span> <a href="https://www.flypeach.com/tw" target="_blank" class="text-indigo-500 hover:underline text-sm">[樂桃]</a></li>
                                <li>🔴 <span class="font-medium">申請休假</span></li>
                            </ul>
                        </div>
                        <div class="bg-white p-6 rounded-lg shadow-md border border-gray-200">
                            <h3 class="text-xl font-bold text-[var(--accent-primary)] mb-3">第二階段：細節規劃</h3>
                            <p class="font-semibold text-slate-500 text-sm mb-4">2025/11 ~ 12月</p>
                            <ul class="space-y-2 text-slate-600">
                                <li>🟡 <span class="font-medium">採購個人裝備</span></li>
                                <li>🟡 <span class="font-medium">購買網卡</span> <a href="https://www.klook.com/zh-TW/activity/109393-japan-esim-high-speed-internet-qr-code-voucher/" target="_blank" class="text-indigo-500 hover:underline text-sm">[eSIM參考]</a></li>
                                <li>🟡 <span class="font-medium">購買保險</span></li>
                                <li>🟡 <span class="font-medium">預訂高鐵</span></li>
                                <li>🟡 <span class="font-medium">兌換日幣</span></li>
                            </ul>
                        </div>
                        <div class="bg-white p-6 rounded-lg shadow-md border border-gray-200">
                            <h3 class="text-xl font-bold text-[var(--accent-primary)] mb-3">第三階段：最終衝刺</h3>
                            <p class="font-semibold text-slate-500 text-sm mb-4">2026/1月</p>
                            <ul class="space-y-2 text-slate-600">
                                <li>🔵 <span class="font-medium">填寫 Visit Japan Web</span></li>
                                <li>🔵 <span class="font-medium">打包行李</span></li>
                                <li>🔵 <span class="font-medium">最終確認與休息</span></li>
                            </ul>
                        </div>
                    </div>
                </section>

                <section id="checklist">
                    <h2 class="text-3xl font-bold text-center mb-4">互動式準備清單</h2>
                    <p class="text-center text-slate-600 mb-8 max-w-2xl mx-auto">此清單專注於您需自行採購與打包的物品。當地租賃裝備請參考行程總覽。</p>
                    <div id="checklist-filters" class="flex flex-wrap justify-center gap-2 mb-8">
                    </div>
                    <div id="checklist-container" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4">
                    </div>
                </section>
                
                <section id="budget">
                    <h2 class="text-3xl font-bold text-center mb-12">互動式預算分析</h2>
                    <div class="grid grid-cols-1 lg:grid-cols-5 gap-8">
                        <div class="lg:col-span-3 bg-white rounded-2xl shadow-lg p-6 md:p-8 border border-gray-200">
                            <h3 class="text-2xl font-bold mb-6 text-center">費用細項 & 計算機</h3>
                            <table class="w-full text-left mb-6">
                               <thead class="border-b-2 border-gray-200">
                                    <tr><th class="py-2">項目</th><th class="py-2 text-right">費用 (TWD)</th></tr>
                               </thead>
                               <tbody id="budget-table-body">
                               </tbody>
                            </table>
                            <div class="mt-6">
                                <label for="personal-spending" class="block font-medium text-slate-600 mb-2">調整個人花費 (購物、紀念品...)</label>
                                <input type="range" id="personal-spending" min="0" max="20000" step="1000" value="5000" class="w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer">
                                <div class="flex justify-between text-sm text-slate-500 mt-1">
                                    <span>TWD 0</span>
                                    <span id="personal-spending-value" class="font-bold text-[var(--accent-primary)]">TWD 5,000</span>
                                    <span>TWD 20,000</span>
                                </div>
                            </div>
                        </div>
                        <div class="lg:col-span-2 bg-white rounded-2xl shadow-lg p-6 border border-gray-200 flex flex-col justify-between">
                             <div>
                                <h3 class="text-2xl font-bold mb-4 text-center">預估費用佔比</h3>
                                <div class="chart-container">
                                    <canvas id="budgetChart"></canvas>
                                </div>
                             </div>
                             <div class="text-center mt-6">
                                 <p class="text-slate-500">預估總計 (不含個人花費)</p>
                                 <p id="subtotal-cost" class="text-3xl font-bold"></p>
                                 <p class="text-slate-600 mt-4">最終總計 (含個人花費)</p>
                                 <p id="total-cost" class="text-4xl font-bold text-transparent bg-clip-text bg-gradient-to-r from-indigo-600 to-blue-400"></p>
                             </div>
                        </div>
                    </div>
                </section>
            </div>
        </main>
        
        <div class="text-center mt-20">
            <button id="toggle-personal-sections-bottom" class="px-6 py-2 bg-[var(--accent-primary)] text-white font-semibold rounded-full hover:bg-opacity-80 transition-colors shadow-md flex items-center gap-2 mx-auto">
                 <svg id="toggle-icon-show-bottom" class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"></path></svg>
                <svg id="toggle-icon-hide-bottom" class="w-5 h-5 hidden" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13.875 18.825A10.05 10.05 0 0112 19c-4.478 0-8.268-2.943-9.542-7 1.274-4.057 5.064 7 9.542 7 .847 0 1.673.124 2.458.35M18.828 4.172a9.96 9.96 0 013.714 7.828 10.02 10.02 0 01-3.714 7.828M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M1 1l22 22"></path></svg>
                <span id="toggle-text-bottom">顯示個人化工具</span>
            </button>
        </div>

        <footer class="text-center mt-12 pt-8 border-t border-gray-200">
            <p class="text-slate-500">祝您有趟愉快又安全的滑雪之旅！</p>
            <p class="text-sm text-slate-400 mt-1">互動儀表板 by Gemini</p>
        </footer>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const checklistData = [
                { name: '運動排汗衣褲', category: 'buy', description: '準備2套，絕對避免棉質！選擇聚酯纖維或羊毛材質。' },
                { name: '刷毛中層衣', category: 'buy', description: '1-2件，作為保暖中層。' },
                { name: '中高筒雪襪', category: 'buy', description: '準備5雙，羊毛或機能材質，保護腳踝。' },
                { name: '面罩/脖圍', category: 'buy', description: '防風、防曬、保護臉部。' },
                { name: '拋棄式內褲', category: 'buy', description: '方便旅行使用，依天數準備。' },
                { name: '護照/身分證', category: 'pack', description: '最重要的身分證明文件。' },
                { name: '日幣現金/信用卡', category: 'pack', description: '準備足夠的現金以備不時之需。' },
                { name: '個人藥品', category: 'pack', description: '感冒藥、腸胃藥、止痛藥、痠痛貼布等。' },
                { name: '生理用品', category: 'pack', description: '若遇生理期，請預先準備相關用品。' },
                { name: '維持器', category: 'pack', description: '個人牙齒維持器。' },
                { name: '防曬乳/護唇膏', category: 'pack', description: '雪地紫外線強烈，空氣乾燥。' },
                { name: '手機/充電器', category: 'pack', description: '包含行動電源，保持通訊暢通。' },
                { name: '日本上網卡/WiFi', category: 'pack', description: '預先購買或租用，確保網路連線。' },
                { name: '防水雪靴', category: 'pack', description: '非滑雪時在雪地行走穿著。' },
                { name: '日常便服', category: 'pack', description: '準備2套，在旅館或非滑雪時穿著。' },
                { name: '泳衣', category: 'pack', description: '野澤是溫泉鄉，別忘了泡溫泉！' }
            ];

            let budgetChart;
            const budgetItems = [
                { label: '✈️ 機票', cost: 16000 },
                { label: '🏂 教練課', cost: 12667 },
                { label: '🏨 住宿', cost: 15000 },
                { label: '🍜 餐飲', cost: 10000 },
                { label: '🎟️ 雪票', cost: 5000 },
                { label: '🎿 雪具', cost: 3500 },
                { label: '🚄 交通', cost: 4200 }
            ];

            const startCountdown = () => {
                const targetDate = new Date('2026-01-14T00:00:00').getTime();
                const countdownEl = document.getElementById('countdown');
                const interval = setInterval(() => {
                    const now = new Date().getTime();
                    const distance = targetDate - now;
                    if (distance < 0) {
                        clearInterval(interval);
                        countdownEl.innerHTML = "出發！";
                        return;
                    }
                    const days = Math.floor(distance / (1000 * 60 * 60 * 24));
                    countdownEl.innerHTML = `${days} 天`;
                }, 1000);
            };

            const setupChecklist = () => {
                const filtersContainer = document.getElementById('checklist-filters');
                const checklistContainer = document.getElementById('checklist-container');
                const categories = { 'all': '全部項目', 'buy': '自行採購', 'pack': '打包用品' };

                const renderChecklist = (filter = 'all') => {
                    checklistContainer.innerHTML = '';
                    const filteredData = filter === 'all' ? checklistData : checklistData.filter(item => item.category === filter);
                    
                    filteredData.forEach(item => {
                        const itemEl = document.createElement('div');
                        itemEl.className = 'bg-white p-4 rounded-lg shadow border border-gray-200 flex items-center space-x-3 cursor-pointer hover:shadow-md transition-shadow group relative';
                        itemEl.innerHTML = `
                            <input type="checkbox" class="h-5 w-5 rounded border-gray-300 text-indigo-600 focus:ring-indigo-500">
                            <label class="font-medium text-slate-700">${item.name}</label>
                            <div class="absolute bottom-full mb-2 w-max max-w-xs left-1/2 -translate-x-1/2 bg-slate-800 text-white text-xs rounded py-1 px-2 opacity-0 group-hover:opacity-100 transition-opacity pointer-events-none z-10">
                                ${item.description}
                                <svg class="absolute text-slate-800 h-2 w-full left-0 top-full" x="0px" y="0px" viewBox="0 0 255 255" xml:space="preserve"><polygon class="fill-current" points="0,0 127.5,127.5 255,0"/></svg>
                            </div>
                        `;
                        checklistContainer.appendChild(itemEl);
                    });
                };

                Object.keys(categories).forEach(key => {
                    const button = document.createElement('button');
                    button.textContent = categories[key];
                    button.dataset.filter = key;
                    button.className = 'btn-filter px-4 py-2 rounded-full font-semibold text-sm transition bg-white border border-gray-300 hover:bg-gray-100';
                    if (key === 'all') button.classList.add('active');
                    button.addEventListener('click', () => {
                        document.querySelectorAll('.btn-filter').forEach(btn => btn.classList.remove('active'));
                        button.classList.add('active');
                        renderChecklist(key);
                    });
                    filtersContainer.appendChild(button);
                });

                renderChecklist();
            };

            const setupBudgetCalculator = () => {
                const spendingSlider = document.getElementById('personal-spending');
                const spendingValueEl = document.getElementById('personal-spending-value');
                const subtotalEl = document.getElementById('subtotal-cost');
                const totalEl = document.getElementById('total-cost');
                const tableBody = document.getElementById('budget-table-body');
                
                const formatCurrency = (num) => `TWD ${num.toLocaleString()}`;

                const renderTable = () => {
                    tableBody.innerHTML = '';
                    budgetItems.forEach(item => {
                        const row = `
                            <tr class="border-b border-gray-200">
                                <td class="py-3 pr-2">${item.label}</td>
                                <td class="py-3 text-right font-semibold">${item.cost.toLocaleString()}</td>
                            </tr>`;
                        tableBody.innerHTML += row;
                    });
                };
                
                const updateChart = (personalSpending) => {
                    const subtotal = budgetItems.reduce((sum, item) => sum + item.cost, 0);
                    const total = subtotal + personalSpending;
                    
                    const chartData = budgetItems.map(item => item.cost);
                    const chartLabels = budgetItems.map(item => item.label.split(' ')[1]);

                    if (personalSpending > 0) {
                        chartData.push(personalSpending);
                        chartLabels.push('個人花費');
                    }

                    if (budgetChart) {
                        budgetChart.data.labels = chartLabels;
                        budgetChart.data.datasets[0].data = chartData;
                        budgetChart.update();
                    } else {
                        const ctx = document.getElementById('budgetChart').getContext('2d');
                        budgetChart = new Chart(ctx, {
                            type: 'doughnut',
                            data: {
                                labels: chartLabels,
                                datasets: [{
                                    data: chartData,
                                    backgroundColor: ['#1a365d', '#a97c50', '#4a5568', '#f6ad55', '#81e6d9', '#f6e05e', '#a0aec0'],
                                    borderColor: '#ffffff',
                                    borderWidth: 4,
                                    hoverOffset: 8
                                }]
                            },
                            options: {
                                responsive: true,
                                maintainAspectRatio: false,
                                plugins: { legend: { display: false } },
                                cutout: '70%'
                            }
                        });
                    }
                    
                    subtotalEl.textContent = formatCurrency(subtotal);
                    totalEl.textContent = formatCurrency(total);
                };

                spendingSlider.addEventListener('input', (e) => {
                    const value = parseInt(e.target.value);
                    spendingValueEl.textContent = formatCurrency(value);
                    updateChart(value);
                });
                
                renderTable();
                updateChart(parseInt(spendingSlider.value));
            };
            
            const setupViewToggle = () => {
                const toggleBtnBottom = document.getElementById('toggle-personal-sections-bottom');

                const personalSections = document.getElementById('personal-sections');
                const personalNavLinks = document.querySelectorAll('.personal-nav-link');
                
                const toggleTextBottom = document.getElementById('toggle-text-bottom');
                const iconShowBottom = document.getElementById('toggle-icon-show-bottom');
                const iconHideBottom = document.getElementById('toggle-icon-hide-bottom');

                const performToggle = () => {
                    const isHidden = personalSections.classList.contains('hidden');
                    personalSections.classList.toggle('hidden');
                    personalNavLinks.forEach(link => link.classList.toggle('hidden'));
                    
                    if (isHidden) {
                        toggleTextBottom.textContent = '隱藏個人化工具';
                        iconShowBottom.classList.add('hidden');
                        iconHideBottom.classList.remove('hidden');
                    } else {
                        toggleTextBottom.textContent = '顯示個人化工具';
                        iconShowBottom.classList.remove('hidden');
                        iconHideBottom.classList.add('hidden');
                    }
                }
                
                if(toggleBtnBottom) {
                    toggleBtnBottom.addEventListener('click', performToggle);
                }
            };

            startCountdown();
            setupChecklist();
            setupBudgetCalculator();
            setupViewToggle();
        });
    </script>
</body>
</html>

